<!doctype html>
<html>
  <head>
    <style>
      /* 전체 스타일 */
      body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #1a1a1a;
        color: #e0e0e0;
      }

      /* 중앙 정렬 */
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      /* 카드 스타일 */
      .card {
        background-color: #2a2a2a;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      }

      /* 헤더 스타일 */
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        border-bottom: 2px solid #e54d47;
      }

      header h1 {
        font-size: 2.2rem;
        font-weight: bold;
        color: #e54d47;
      }

      header span {
        font-size: 1rem;
        font-weight: 600;
        color: #e0e0e0;
        padding: 4px 12px;
        border-radius: 4px;
        background-color: #e54d47;
      }

      /* 폼 및 버튼 스타일 */
      .form-field,
      button {
        margin-bottom: 16px;
      }

      button,
      .submit-btn {
        background-color: #e54d47;
        color: white;
        border-radius: 12px;
        padding: 10px 20px;
        font-weight: bold;
        font-size: 1rem;
        cursor: pointer;
      }

      button:hover,
      .submit-btn:hover {
        background-color: #ff6f61;
      }

      .form-control,
      .form-select {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        background-color: #3a3a3a;
        color: #e0e0e0;
        border: none;
      }

      .form-control:focus,
      .form-select:focus {
        outline: none;
        box-shadow: 0 0 6px #e54d47;
      }

      /* 이미지 업로드 스타일 */
      .image-upload-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 16px;
      }

      .img-thumbnail {
        width: 200px;
        height: 200px;
        object-fit: cover;
        border-radius: 12px;
      }

      .no-image {
        width: 200px;
        height: 200px;
        object-fit: cover;
      }

      #chooseFileBtn {
        padding: 10px 20px;
        background-color: #e54d47;
        color: white;
        font-weight: bold;
        border-radius: 12px;
      }

      #chooseFileBtn:hover {
        background-color: #ff6f61;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="card">
        <header>
          <h1>미션 생성</h1>
          <span>로그인/회원가입</span>
        </header>
        <div class="row g-4">
          <div class="image-upload-container">
            <img
              src="src/public/default.png"
              class="img-thumbnail"
              id="imagePreview"
              alt="이미지 미리보기"
            />
            <input
              type="file"
              id="thumbnail"
              accept="image/*"
              style="display: none"
            />
            <button id="chooseFileBtn">파일 선택</button>
          </div>

          <div class="form-field">
            <label for="title" class="form-label">[미션] 제목</label>
            <input
              type="text"
              id="title"
              class="form-control"
              placeholder="미션 제목을 입력하세요."
            />
          </div>

          <div class="form-field">
            <label for="category" class="form-label">[미션] 카테고리</label>
            <select id="category" class="form-select">
              <option value="">카테고리를 선택하세요</option>
              <option value="Sports">스포츠</option>
              <option value="Cooking">요리</option>
              <option value="Music">음악</option>
              <option value="Photography">사진</option>
              <option value="Workout">헬스</option>
              <option value="Reading">독서</option>
              <option value="Study">학습</option>
              <option value="Selfhelp">자기계발</option>
            </select>
          </div>

          <div class="form-field">
            <label for="challengePeriod" class="form-label"
              >[챌린지] 기간</label
            >
            <input
              type="date"
              id="challengeStartDate"
              class="form-control"
              placeholder="시작 날짜를 선택하세요"
            />
            <input
              type="date"
              id="challengeEndDate"
              class="form-control"
              placeholder="종료 날짜를 선택하세요"
            />
            <div id="challengeWarning" class="text-danger"></div>
          </div>

          <div class="form-field">
            <label for="amount" class="form-label">[정원]</label>
            <select id="amount" class="form-select">
              <option value="">선택하세요</option>
              <option value="5">5명</option>
              <option value="10">10명</option>
              <option value="15">15명</option>
              <option value="20">20명</option>
              <option value="25">25명</option>
              <option value="30">30명</option>
              <option value="35">35명</option>
              <option value="40">40명</option>
              <option value="45">45명</option>
              <option value="50">50명</option>
            </select>
          </div>

          <div class="form-field">
            <label for="description" class="form-label">[설명]</label>
            <textarea
              id="description"
              class="form-control"
              placeholder="미션 설명을 작성해주세요."
              rows="3"
            ></textarea>
          </div>

          <button class="submit-btn" id="submitBtn">등록하기</button>
        </div>
      </div>
    </div>

    <script>
      // 입력 데이터 유효성 검사
      function validateInputs() {
        // 다른 입력 필드 검사 ...
        const numberPeopleInput = document
          .getElementById('amount')
          .value.trim();

        // `numberPeople` 유효성 검사
        if (!numberPeopleInput) {
          alert('정원을 입력하세요.');
          return false;
        }

        // 정수인지 확인
        const numberPeopleValue = parseInt(numberPeopleInput, 10);
        if (isNaN(numberPeopleValue) || numberPeopleValue <= 0) {
          alert('정원을 올바르게 입력하세요.');
          return false;
        }

        // 모든 유효성 검사 통과 시 true 반환
        return true;
      }

      // 파일 선택 버튼 클릭 시 파일 선택창 열기
      document
        .getElementById('chooseFileBtn')
        .addEventListener('click', function () {
          document.getElementById('thumbnail').click();
        });

      // 이미지 미리보기 업데이트
      document
        .getElementById('thumbnail')
        .addEventListener('change', function (event) {
          const file = event.target.files[0];
          const reader = new FileReader();

          reader.onload = function (e) {
            document.getElementById('imagePreview').src = e.target.result;
          };

          if (file) {
            reader.readAsDataURL(file);
          } else {
            document.getElementById('imagePreview').src =
              'src/public/default.png';
          }
        });

      // 등록하기 버튼 클릭 시 데이터 제출
      document
        .getElementById('submitBtn')
        .addEventListener('click', function (event) {
          event.preventDefault();

          // 입력 유효성 검사 수행
          if (!validateInputs()) {
            return;
          }

          const formData = new FormData();
          formData.append(
            'title',
            document.getElementById('title').value.trim(),
          );
          formData.append(
            'category',
            document.getElementById('category').value,
          );
          formData.append(
            'description',
            document.getElementById('description').value.trim(),
          );
          formData.append(
            'thumbnail',
            document.getElementById('thumbnail').files[0],
          );
          formData.append(
            'startDate',
            document.getElementById('challengeStartDate').value,
          );
          formData.append(
            'endDate',
            document.getElementById('challengeEndDate').value,
          );
          formData.append(
            'numberPeople',
            document.getElementById('amount').value,
          ); // 'amount'를 'numberPeople'로 변경

          fetch('/mission/create', {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${document.cookie.replace(/(?:(?:^|.*;\s*)authorization\s*\=\s*([^;]*).*$)|^.*$/, '$1')}`, // 쿠키에서 authorization 토큰을 추출하여 헤더에 추가
            },

            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                alert('미션이 성공적으로 생성되었습니다.');
              } else {
                alert(`미션 생성에 실패했습니다: ${data.message}`);
              }
            })
            .catch((error) => {
              console.error('미션 생성 중 에러가 발생했습니다:', error);
              alert(
                '미션 생성 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.',
              );
            });
        });
    </script>
  </body>
</html>
