<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Mission</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      /* 전체 스타일 */
      body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #1a1a1a;
        color: #e0e0e0;
      }

      /* 중앙 정렬 */
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      /* 카드 스타일 */
      .card {
        background-color: #2a2a2a;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      }

      /* 헤더 스타일 */
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        border-bottom: 2px solid #e54d47;
      }

      header h1 {
        font-size: 2.2rem;
        font-weight: bold;
        color: #e54d47;
      }

      header span {
        font-size: 1rem;
        font-weight: 600;
        color: #e0e0e0;
        padding: 4px 12px;
        border-radius: 4px;
        background-color: #e54d47;
      }

      /* 폼 및 버튼 스타일 */
      .form-field {
        margin-bottom: 16px;
      }

      .btn {
        background-color: #e54d47;
        color: white;
        border-radius: 12px;
        padding: 10px 20px;
        font-weight: bold;
        font-size: 1rem;
        cursor: pointer;
      }

      .btn:hover {
        background-color: #ff6f61;
      }

      .form-control,
      .form-select {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        background-color: #3a3a3a;
        color: #e0e0e0;
        border: none;
      }

      .form-control:focus,
      .form-select:focus {
        outline: none;
        box-shadow: 0 0 6px #e54d47;
      }

      /* 이미지 업로드 스타일 */
      .img-upload {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-bottom: 16px;
      }

      .thumbnail {
        width: 200px;
        height: 200px;
        object-fit: cover;
        border-radius: 12px;
      }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <header>
      <h1>미션 생성</h1>
      <span>로그인/회원가입</span>
    </header>
    <div class="container">
      <div class="card">
        <form id="missionForm">
          <div class="img-upload">
            <img
              id="thumbnailPreview"
              src="https://static.thenounproject.com/png/4595376-200.png"
              class="thumbnail"
              alt="이미지 미리보기"
            />
            <input type="file" id="fileInput" accept="image/*" />
          </div>
          <div class="form-field">
            <label for="title" class="form-label">[미션] 제목</label>
            <input
              type="text"
              id="title"
              class="form-control"
              placeholder="미션 제목을 입력하세요."
            />
          </div>
          <div class="form-field">
            <label for="category" class="form-label">[미션] 카테고리</label>
            <select id="category" class="form-select">
              <option value="">카테고리를 선택하세요</option>
              <option value="Sports">스포츠</option>
              <option value="Cooking">요리</option>
              <option value="Music">음악</option>
              <option value="Photography">사진</option>
              <option value="Workout">헬스</option>
              <option value="Reading">독서</option>
              <option value="Study">학습</option>
              <option value="Selfhelp">자기계발</option>
            </select>
          </div>
          <div class="form-field">
            <label for="startDate" class="form-label">[챌린지] 시작 날짜</label>
            <input type="date" id="startDate" class="form-control" />
          </div>
          <div class="form-field">
            <label for="endDate" class="form-label">[챌린지] 종료 날짜</label>
            <input type="date" id="endDate" class="form-control" />
          </div>
          <div class="form-field">
            <label for="participants" class="form-label">[정원]</label>
            <select id="participants" class="form-select">
              <option value="">선택하세요</option>
              <option value="5">5명</option>
              <option value="10">10명</option>
              <option value="15">15명</option>
              <option value="20">20명</option>
              <option value="25">25명</option>
              <option value="30">30명</option>
              <option value="35">35명</option>
              <option value="40">40명</option>
              <option value="45">45명</option>
              <option value="50">50명</option>
            </select>
          </div>
          <div class="form-field">
            <label for="description" class="form-label">[설명]</label>
            <textarea
              id="description"
              class="form-control"
              placeholder="미션 설명을 작성해주세요."
              rows="3"
            ></textarea>
          </div>
          <button type="submit" id="submitBtn" class="btn">등록하기</button>
        </form>
      </div>
    </div>
    <script>
      // 파일 선택 시 이미지 미리보기 업데이트
      $('#fileInput').change(function (event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            $('#thumbnailPreview').attr('src', e.target.result);
          };
          reader.readAsDataURL(file);
        }
      });

      // 미션 등록 버튼 클릭 시
      $('#missionForm').submit(function (event) {
        event.preventDefault();

        const formData = new FormData();
        const fileInput = document.querySelector('#fileInput');

        // 파일 입력 요소 유효성 검사
        if (fileInput && fileInput.files && fileInput.files.length > 0) {
          formData.append('thumbnail', fileInput.files[0]);
        } else {
          alert('파일을 선택해주세요.');
          return;
        }

        // 다른 입력 필드 데이터를 formData에 추가
        formData.append('title', $('#title').val().trim());
        formData.append('category', $('#category').val());
        formData.append('startDate', $('#startDate').val());
        formData.append('endDate', $('#endDate').val());
        formData.append('numberPeople', $('#participants').val());
        formData.append('description', $('#description').val().trim());

        // 미션 생성 요청 전송
        fetch('/mission/create', {
          method: 'POST',
          headers: {
            Authorization: `Bearer ${document.cookie.replace(/(?:(?:^|.*;\s*)authorization\s*\=\s*([^;]*).*$)|^.*$/, '$1')}`,
          },
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert('미션이 성공적으로 생성되었습니다.');
            } else {
              alert(`미션 생성에 실패했습니다: ${data.message}`);
            }
          })
          .catch((error) => {
            console.error('미션 생성 중 오류가 발생했습니다:', error);
            alert(
              '미션 생성 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.',
            );
          });
      });
    </script>
  </body>
</html>
